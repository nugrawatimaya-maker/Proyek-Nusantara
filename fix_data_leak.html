<!DOCTYPE html>
<html lang="id">

<head>
    <meta charset="UTF-8">
    <title>Fix Data Leak Tool</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="supabase.js"></script>
    <script src="app_config.js"></script>
    <script src="auth.js"></script>
</head>

<body class="bg-gray-100 p-10 flex items-center justify-center min-h-screen">

    <div class="bg-white p-8 rounded-xl shadow-lg max-w-lg w-full text-center">
        <h1 class="text-2xl font-bold text-gray-800 mb-4">üõ†Ô∏è Data Correction Tool</h1>
        <p class="text-gray-600 mb-6">Alat ini akan memindahkan <strong>PO/NLD/2026/01/9735</strong> ke proyek
            <strong>Sunrise City Pinrang</strong>.</p>

        <div id="status" class="hidden mb-4 p-3 rounded-lg text-sm font-bold"></div>

        <button onclick="runFix()" id="btnFix"
            class="bg-blue-600 hover:bg-blue-700 text-white px-6 py-3 rounded-lg font-bold w-full transition shadow-lg">
            Jalankan Perbaikan
        </button>

        <p class="mt-4 text-xs text-gray-400">File ini aman untuk dihapus setelah digunakan.</p>
    </div>

    <script>
        async function runFix() {
            const btn = document.getElementById('btnFix');
            const status = document.getElementById('status');

            btn.disabled = true;
            btn.innerHTML = "Memproses...";
            status.className = "hidden";

            try {
                // Konfigurasi Target
                const targetPO = "PO/NLD/2026/01/9735";
                const targetProject = "Sunrise City Pinrang";

                // 1. Cek Data Sebelum
                const { data: before } = await client.from('purchase_order').select('nama_proyek').eq('nomor_po', targetPO);
                if (!before || before.length === 0) throw new Error("PO Tidak Ditemukan!");
                console.log("Before:", before[0]);

                // 2. Lakukan Update
                const { error } = await client.from('purchase_order')
                    .update({ nama_proyek: targetProject })
                    .eq('nomor_po', targetPO);

                if (error) throw error;

                // 3. Verifikasi
                const { data: after } = await client.from('purchase_order').select('nama_proyek').eq('nomor_po', targetPO);

                status.innerText = `‚úÖ SUKSES! PO dipindahkan ke: ${after[0].nama_proyek}`;
                status.className = "block bg-green-100 text-green-700 p-3 rounded-lg text-sm font-bold mb-4";
                btn.innerHTML = "Selesai";

            } catch (e) {
                console.error(e);
                status.innerText = "‚ùå ERROR: " + e.message;
                status.className = "block bg-red-100 text-red-700 p-3 rounded-lg text-sm font-bold mb-4";
                btn.disabled = false;
                btn.innerHTML = "Coba Lagi";
            }
        }
    </script>
</body>

</html>