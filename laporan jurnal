<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Laporan Jurnal Umum</title>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script src="https://cdn.tailwindcss.com"></script> 
</head>
<body class="bg-gray-100 text-gray-800 font-sans">

  <div class="bg-white shadow sticky top-0 z-10">
    <div class="max-w-6xl mx-auto px-4 py-4 flex justify-between items-center">
      <div>
        <h1 class="text-2xl font-bold text-blue-700">Laporan Jurnal Umum</h1>
        <p class="text-sm text-gray-500">Rekapan otomatis Debit & Kredit</p>
      </div>
      <div class="space-x-2">
        <a href="kas_masuk.html" class="px-4 py-2 bg-green-600 text-white rounded hover:bg-green-700 text-sm">Input Masuk</a>
        <a href="kas_keluar.html" class="px-4 py-2 bg-red-600 text-white rounded hover:bg-red-700 text-sm">Input Keluar</a>
      </div>
    </div>
  </div>

  <main class="max-w-6xl mx-auto px-4 py-8">
    
    <div class="bg-white rounded-lg shadow overflow-hidden">
      <table class="w-full text-left border-collapse">
        <thead class="bg-gray-200 text-gray-700 uppercase text-xs font-bold">
          <tr>
            <th class="p-4 border-b">Tanggal</th>
            <th class="p-4 border-b">Akun / Keterangan</th>
            <th class="p-4 border-b text-right">Debit</th>
            <th class="p-4 border-b text-right">Kredit</th>
          </tr>
        </thead>
        <tbody id="tabelBody" class="text-sm">
          <tr><td colspan="4" class="p-6 text-center text-gray-400">Sedang memuat data...</td></tr>
        </tbody>
        <tfoot class="bg-gray-100 font-bold border-t-2 border-gray-300">
          <tr>
            <td colspan="2" class="p-4 text-right">TOTAL:</td>
            <td id="totalDebit" class="p-4 text-right text-blue-700">Rp 0</td>
            <td id="totalKredit" class="p-4 text-right text-green-700">Rp 0</td>
          </tr>
        </tfoot>
      </table>
    </div>

  </main>

  <script>
    // --- KONFIGURASI SUPABASE ---
    const supabaseUrl = "https://nbpxmramqufvxiikxbve.supabase.co";
    const supabaseKey = "sb_publishable_peLRGV8YGA5djczYBgLnkQ_buXXBknN"; // Ganti dengan Key Anda jika beda
    const client = supabase.createClient(supabaseUrl, supabaseKey);

    // --- FUNGSI FORMAT RUPIAH ---
    const formatRupiah = (angka) => {
      return new Intl.NumberFormat('id-ID', { style: 'currency', currency: 'IDR' }).format(angka);
    };

    // --- LOAD DATA JURNAL ---
    async function loadJurnal() {
      // Ambil data dari tabel jurnal_umum, urutkan tanggal terbaru
      const { data, error } = await client
        .from('jurnal_umum')
        .select('*')
        .order('tanggal', { ascending: false }) // Paling baru di atas
        .order('id', { ascending: false });     // Biar urutan debit/kredit rapi

      if (error) {
        console.error("Error:", error);
        document.getElementById("tabelBody").innerHTML = `<tr><td colspan="4" class="p-4 text-center text-red-500">Gagal memuat data: ${error.message}</td></tr>`;
        return;
      }

      const tbody = document.getElementById("tabelBody");
      tbody.innerHTML = ""; // Bersihkan loading

      let sumDebit = 0;
      let sumKredit = 0;

      data.forEach((row, index) => {
        sumDebit += row.debit;
        sumKredit += row.kredit;

        // Trik Visual: Kalau kredit (row.kredit > 0), kita geser teks akunya sedikit ke kanan (indent)
        // Ini standar akuntansi biar mudah dibaca.
        const indentClass = row.kredit > 0 ? "pl-8 text-gray-600 italic" : "font-semibold text-gray-800";
        
        // Warna baris selang-seling tiap transaksi (opsional, logika sederhana dulu)
        const rowClass = "hover:bg-gray-50 border-b";

        const tr = `
          <tr class="${rowClass}">
            <td class="p-3 align-top">${row.tanggal}</td>
            <td class="p-3 align-top">
              <div class="${indentClass}">${row.nama_akun}</div>
              <div class="text-xs text-gray-400 mt-1">${row.keterangan || '-'}</div>
            </td>
            <td class="p-3 text-right align-top ${row.debit > 0 ? 'text-gray-900' : 'text-gray-300'}">
              ${row.debit > 0 ? formatRupiah(row.debit) : '-'}
            </td>
            <td class="p-3 text-right align-top ${row.kredit > 0 ? 'text-gray-900' : 'text-gray-300'}">
              ${row.kredit > 0 ? formatRupiah(row.kredit) : '-'}
            </td>
          </tr>
        `;
        tbody.innerHTML += tr;
      });

      // Update Total
      document.getElementById("totalDebit").innerText = formatRupiah(sumDebit);
      document.getElementById("totalKredit").innerText = formatRupiah(sumKredit);
      
      // Cek Balance
      if(sumDebit === sumKredit) {
          document.getElementById("totalKredit").innerHTML += " <span class='text-xs bg-green-200 text-green-800 px-2 py-1 rounded ml-2'>Balance ✅</span>";
      } else {
          document.getElementById("totalKredit").innerHTML += " <span class='text-xs bg-red-200 text-red-800 px-2 py-1 rounded ml-2'>Tidak Balance ❌</span>";
      }
    }

    // Jalankan saat buka halaman
    loadJurnal();
  </script>
</body>
</html>