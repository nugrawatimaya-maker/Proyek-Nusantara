<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>Laporan Keuangan Pro</title>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
  
  <style>
    body { background-color: #f8fafc; font-family: 'Inter', sans-serif; -webkit-tap-highlight-color: transparent; }
    
    .menu-card { transition: all 0.2s; cursor: pointer; border: 1px solid #e2e8f0; }
    .menu-card:hover, .menu-card.active { 
        background-color: #eff6ff; border-color: #3b82f6; transform: translateY(-2px); 
        box-shadow: 0 4px 6px -1px rgba(59, 130, 246, 0.1);
    }
    .menu-card.active i { color: #2563eb; }
    
    /* Indikator Balance */
    .status-balance { background: #dcfce7; color: #166534; border: 1px solid #86efac; }
    .status-unbalance { background: #fee2e2; color: #991b1b; border: 1px solid #fca5a5; animation: pulse 2s infinite; }
    @keyframes pulse { 0% { opacity: 1; } 50% { opacity: 0.8; } 100% { opacity: 1; } }

    @media (max-width: 640px) {
        .mobile-sticky { position: sticky; top: 0; z-index: 40; background: white; padding: 10px; border-bottom: 1px solid #e2e8f0; }
        .hide-mobile { display: none; }
    }
    @media print {
        body { background: white; }
        .no-print { display: none !important; }
        .print-only { display: block !important; }
        #laporanArea { box-shadow: none; padding: 0; }
    }
    .print-only { display: none; }
  </style>
</head>
<body class="pb-20">

  <nav class="bg-white border-b px-4 py-3 flex justify-between items-center sticky top-0 z-50 shadow-sm">
    <div class="flex items-center gap-3">
        <div class="bg-blue-600 text-white p-2 rounded-lg"><i class="fas fa-chart-line"></i></div>
        <div>
            <h1 class="text-sm font-bold text-slate-800 leading-tight">Financial Report</h1>
            <p class="text-[10px] text-slate-500">NLD Corp Integrated System</p>
        </div>
    </div>
    <a href="dashboard_operasional.html" class="bg-slate-100 text-slate-600 p-2 rounded-full hover:bg-slate-200 transition">
        <i class="fas fa-times"></i>
    </a>
  </nav>

  <div class="p-4 no-print overflow-x-auto">
      <div class="grid grid-cols-2 md:grid-cols-7 gap-3 min-w-[600px]">
        <a href="input_jurnal_umum.html" class="menu-card bg-white p-3 rounded-xl flex flex-col items-center text-center gap-2 border border-dashed border-slate-300 hover:border-blue-500">
            <i class="fas fa-pencil-alt text-slate-400 text-xl mb-1"></i>
            <span class="text-[10px] font-bold text-slate-700">Input Jurnal</span>
        </a>
        <div onclick="pilihLaporan('JURNAL', this)" class="menu-card active bg-white p-3 rounded-xl flex flex-col items-center text-center gap-2">
            <i class="fas fa-book text-slate-400 text-xl mb-1"></i>
            <span class="text-[10px] font-bold text-slate-700">Jurnal Umum</span>
        </div>
        <div onclick="pilihLaporan('BUKU_BESAR', this)" class="menu-card bg-white p-3 rounded-xl flex flex-col items-center text-center gap-2">
            <i class="fas fa-book-open text-slate-400 text-xl mb-1"></i>
            <span class="text-[10px] font-bold text-slate-700">Buku Besar</span>
        </div>
        <div onclick="pilihLaporan('NERACA_SALDO', this)" class="menu-card bg-white p-3 rounded-xl flex flex-col items-center text-center gap-2 border-l-4 border-l-orange-400">
            <i class="fas fa-scale-balanced text-slate-400 text-xl mb-1"></i>
            <span class="text-[10px] font-bold text-slate-700">Neraca Saldo</span>
        </div>
        <div onclick="pilihLaporan('NERACA_LAJUR', this)" class="menu-card bg-white p-3 rounded-xl flex flex-col items-center text-center gap-2">
            <i class="fas fa-table text-slate-400 text-xl mb-1"></i>
            <span class="text-[10px] font-bold text-slate-700">Worksheet</span>
        </div>
        <div onclick="pilihLaporan('LABA_RUGI', this)" class="menu-card bg-white p-3 rounded-xl flex flex-col items-center text-center gap-2">
            <i class="fas fa-chart-pie text-slate-400 text-xl mb-1"></i>
            <span class="text-[10px] font-bold text-slate-700">Laba Rugi</span>
        </div>
        <div onclick="pilihLaporan('NERACA', this)" class="menu-card bg-white p-3 rounded-xl flex flex-col items-center text-center gap-2">
            <i class="fas fa-landmark text-slate-400 text-xl mb-1"></i>
            <span class="text-[10px] font-bold text-slate-700">Neraca</span>
        </div>
      </div>
  </div>

  <div class="mobile-sticky px-4 pb-2 no-print">
      <div class="bg-slate-50 border border-slate-200 p-3 rounded-lg flex flex-wrap items-center gap-3 justify-between">
          <div class="flex items-center gap-2 w-full md:w-auto">
              <input type="date" id="tglMulai" class="bg-white border p-2 rounded text-xs font-bold w-1/2 md:w-32 outline-none">
              <span class="text-slate-400">-</span>
              <input type="date" id="tglSelesai" class="bg-white border p-2 rounded text-xs font-bold w-1/2 md:w-32 outline-none">
          </div>
          <button onclick="loadData()" class="bg-blue-600 hover:bg-blue-700 text-white w-full md:w-auto px-6 py-2 rounded-lg text-sm font-bold shadow flex justify-center items-center gap-2 transition active:scale-95">
              <i class="fas fa-sync-alt"></i> Tampilkan
          </button>
      </div>
  </div>

  <main class="p-4 md:p-6 max-w-6xl mx-auto">
      <div id="laporanArea" class="bg-white shadow-xl min-h-[600px] p-6 md:p-10 relative">
          
          <div id="kopSurat" class="print-only text-center border-b-4 border-double border-slate-800 pb-4 mb-6">
              <h1 class="text-2xl font-bold uppercase tracking-widest font-serif">NLD CORP</h1>
              <h2 class="text-sm font-bold uppercase">PT. Nusantara Land Development</h2>
              <p class="text-[10px] text-slate-500 mt-1">Makassar, Sulawesi Selatan</p>
          </div>

          <div class="text-center mb-6">
              <h2 id="judulLap" class="text-xl font-bold text-slate-800 underline decoration-2 underline-offset-4 uppercase">JURNAL UMUM</h2>
              <p class="text-xs text-slate-500 mt-1" id="subJudul">Periode: -</p>
              
              <div id="balanceIndicator" class="hidden mt-3 inline-block px-4 py-1 rounded-full text-xs font-bold">
                  CHECKING BALANCE...
              </div>
          </div>

          <div id="konten" class="text-sm overflow-x-auto">
              <div class="py-20 text-center text-slate-400 flex flex-col items-center">
                  <i class="fas fa-search fa-3x mb-3 text-slate-200"></i>
                  <p>Pilih periode lalu klik "Tampilkan"</p>
              </div>
          </div>

          <div class="print-only mt-16 flex justify-end">
              <div class="text-center w-40">
                  <p class="text-xs mb-16">Makassar, <span id="tglCetak"></span></p>
                  <p class="text-xs font-bold border-b border-black pb-1">Finance Manager</p>
              </div>
          </div>
      </div>
  </main>

  <div class="fixed bottom-6 right-6 no-print flex flex-col gap-3">
      <button onclick="downloadPDF()" class="bg-red-600 hover:bg-red-700 text-white w-14 h-14 rounded-full shadow-lg flex items-center justify-center transition hover:scale-110 active:scale-95" title="Download PDF">
          <i class="fas fa-file-pdf fa-lg"></i>
      </button>
  </div>

  <script>
    const supabaseUrl = "https://nbpxmramqufvxiikxbve.supabase.co";
    const supabaseKey = "sb_publishable_peLRGV8YGA5djczYBgLnkQ_buXXBknN"; 
    const client = supabase.createClient(supabaseUrl, supabaseKey);
    const fmt = (n) => new Intl.NumberFormat('id-ID', { style: 'currency', currency: 'IDR', minimumFractionDigits: 0 }).format(n);

    let currentType = 'JURNAL';
    let rawData = [];

    const today = new Date();
    const firstDay = new Date(today.getFullYear(), today.getMonth(), 1);
    document.getElementById("tglMulai").valueAsDate = firstDay;
    document.getElementById("tglSelesai").valueAsDate = today;
    document.getElementById("tglCetak").innerText = today.toLocaleDateString('id-ID');

    function pilihLaporan(type, el) {
        currentType = type;
        document.querySelectorAll('.menu-card').forEach(c => c.classList.remove('active'));
        el.classList.add('active');
        
        const titles = {
            'JURNAL': 'JURNAL UMUM',
            'BUKU_BESAR': 'BUKU BESAR (LEDGER)',
            'NERACA_SALDO': 'NERACA SALDO (TRIAL BALANCE)',
            'NERACA_LAJUR': 'NERACA LAJUR (WORKSHEET)',
            'LABA_RUGI': 'LABA RUGI (PROFIT & LOSS)',
            'NERACA': 'NERACA (BALANCE SHEET)'
        };
        document.getElementById("judulLap").innerText = titles[type];
        document.getElementById("balanceIndicator").className = "hidden"; // Reset indicator
        
        if(rawData.length > 0) renderData();
        else loadData();
    }

    async function loadData() {
        const start = document.getElementById("tglMulai").value;
        const end = document.getElementById("tglSelesai").value;
        const konten = document.getElementById("konten");

        document.getElementById("subJudul").innerText = `Periode: ${new Date(start).toLocaleDateString('id-ID')} s/d ${new Date(end).toLocaleDateString('id-ID')}`;
        konten.innerHTML = `<div class="py-20 text-center"><i class="fas fa-spinner fa-spin text-blue-500 text-2xl"></i><p class="text-xs text-slate-500 mt-2">Mengambil data...</p></div>`;

        const { data, error } = await client
            .from('jurnal_umum')
            .select('*')
            .gte('tanggal', start)
            .lte('tanggal', end)
            .order('tanggal', { ascending: true });

        if(error) { konten.innerHTML = `<div class="text-red-500 text-center p-4">Gagal: ${error.message}</div>`; return; }
        if(!data || data.length === 0) { konten.innerHTML = `<div class="text-slate-400 text-center p-10">Tidak ada data transaksi.</div>`; return; }

        rawData = data;
        renderData();
    }

    function renderData() {
        if(currentType === 'JURNAL') renderJurnal();
        else if(currentType === 'BUKU_BESAR') renderBukuBesar();
        else if(currentType === 'NERACA_SALDO') renderNeracaSaldo();
        else if(currentType === 'NERACA_LAJUR') renderNeracaLajur();
        else if(currentType === 'LABA_RUGI') renderLabaRugi();
        else if(currentType === 'NERACA') renderNeraca();
    }

    function renderJurnal() {
        let html = `<div class="overflow-x-auto"><table class="w-full text-left border-collapse"><thead class="bg-slate-100 text-slate-600 uppercase text-[10px] font-bold"><tr><th class="p-2 border">Tanggal</th><th class="p-2 border">Akun / Keterangan</th><th class="p-2 border text-right">Debit</th><th class="p-2 border text-right">Kredit</th></tr></thead><tbody class="text-xs">`;
        let sumD = 0, sumK = 0;
        rawData.forEach(row => {
            sumD += row.debit; sumK += row.kredit;
            const style = row.kredit > 0 ? "pl-6 italic text-slate-500" : "font-bold text-slate-700";
            html += `<tr><td class="p-2 border text-center whitespace-nowrap text-slate-500">${new Date(row.tanggal).toLocaleDateString('id-ID')}</td><td class="p-2 border"><div class="${style}">${row.nama_akun}</div><div class="text-[9px] text-slate-400">${row.keterangan || '-'}</div></td><td class="p-2 border text-right">${row.debit > 0 ? fmt(row.debit) : '-'}</td><td class="p-2 border text-right">${row.kredit > 0 ? fmt(row.kredit) : '-'}</td></tr>`;
        });
        html += `<tr class="bg-slate-50 font-bold"><td colspan="2" class="p-2 border text-right">TOTAL</td><td class="p-2 border text-right">${fmt(sumD)}</td><td class="p-2 border text-right">${fmt(sumK)}</td></tr></tbody></table></div>`;
        document.getElementById("konten").innerHTML = html;
    }

    function renderBukuBesar() {
        const groups = {};
        rawData.forEach(r => { if(!groups[r.nama_akun]) groups[r.nama_akun] = []; groups[r.nama_akun].push(r); });
        let html = `<div class="space-y-6">`;
        Object.keys(groups).sort().forEach(akun => {
            html += `<div class="border rounded-lg overflow-hidden mb-4"><div class="bg-blue-50 p-2 font-bold text-blue-800 text-xs uppercase border-b">${akun}</div><table class="w-full text-xs text-left"><thead class="bg-slate-50 text-slate-500"><tr><th class="p-2">Tgl</th><th class="p-2">Ket</th><th class="p-2 text-right">Mutasi</th><th class="p-2 text-right">Saldo</th></tr></thead><tbody class="divide-y">`;
            let saldo = 0;
            groups[akun].forEach(r => {
                const mutasi = r.debit - r.kredit; saldo += mutasi;
                const warna = mutasi >= 0 ? "text-green-600" : "text-red-600";
                html += `<tr><td class="p-2 whitespace-nowrap text-slate-500">${new Date(r.tanggal).toLocaleDateString('id-ID')}</td><td class="p-2 truncate max-w-[150px]">${r.keterangan}</td><td class="p-2 text-right ${warna}">${fmt(Math.abs(mutasi))}</td><td class="p-2 text-right font-bold">${fmt(saldo)}</td></tr>`;
            });
            html += `</tbody></table></div>`;
        });
        html += `</div>`;
        document.getElementById("konten").innerHTML = html;
    }

    // --- LOGIKA NERACA SALDO (CHECKER) ---
    function renderNeracaSaldo() {
        const saldos = hitungSaldo();
        let html = `<div class="max-w-3xl mx-auto"><table class="w-full text-left border-collapse text-xs md:text-sm">
            <thead class="bg-slate-800 text-white uppercase font-bold text-center">
                <tr><th class="p-3 border border-slate-700">Nama Akun</th><th class="p-3 border border-slate-700 w-32">Debit</th><th class="p-3 border border-slate-700 w-32">Kredit</th></tr>
            </thead>
            <tbody>`;

        let totalD = 0, totalK = 0;
        
        Object.keys(saldos).sort().forEach(akun => {
            const val = saldos[akun];
            const net = val.debit - val.kredit;
            
            // Logika Dasar Neraca Saldo: Tampilkan Net Balance saja
            let d = 0, k = 0;
            if(net > 0) d = net; // Saldo Debit
            else k = Math.abs(net); // Saldo Kredit

            totalD += d;
            totalK += k;

            if(d === 0 && k === 0) return; // Skip akun 0

            html += `<tr class="hover:bg-slate-50 border-b border-slate-200">
                <td class="p-3 border-r font-medium text-slate-700">${akun}</td>
                <td class="p-3 border-r text-right text-slate-600 font-mono">${d ? fmt(d) : '-'}</td>
                <td class="p-3 text-right text-slate-600 font-mono">${k ? fmt(k) : '-'}</td>
            </tr>`;
        });

        const balance = Math.abs(totalD - totalK) < 1; // Toleransi koma kecil
        const styleBal = balance ? "bg-green-100 text-green-800" : "bg-red-100 text-red-800";
        const iconBal = balance ? "<i class='fas fa-check-circle'></i> BALANCE" : "<i class='fas fa-exclamation-triangle'></i> NOT BALANCE";

        html += `<tr class="font-bold text-sm bg-slate-100 border-t-2 border-slate-800">
            <td class="p-3 text-right">TOTAL</td>
            <td class="p-3 text-right text-slate-800">${fmt(totalD)}</td>
            <td class="p-3 text-right text-slate-800">${fmt(totalK)}</td>
        </tr>`;
        html += `</tbody></table></div>`;

        // Update Indikator Balance di Header
        const ind = document.getElementById("balanceIndicator");
        ind.className = balance ? "mt-3 inline-block px-4 py-1 rounded-full text-xs font-bold status-balance" 
                                : "mt-3 inline-block px-4 py-1 rounded-full text-xs font-bold status-unbalance";
        ind.innerHTML = iconBal + (balance ? "" : ` (Selisih: ${fmt(Math.abs(totalD - totalK))})`);
        ind.classList.remove("hidden");

        document.getElementById("konten").innerHTML = html;
    }

    function renderNeracaLajur() {
        const saldos = hitungSaldo();
        // ... (Kode sama seperti sebelumnya, hanya disederhanakan di sini untuk hemat space, logic tetap)
        // Saya pertahankan logic lengkap Neraca Lajur Anda di sini
        let html = `<div class="overflow-x-auto"><table class="w-full text-left border-collapse text-[10px] md:text-xs">
            <thead class="bg-slate-700 text-white uppercase font-bold text-center">
                <tr>
                    <th rowspan="2" class="p-2 border border-slate-600 sticky left-0 bg-slate-700 z-10 min-w-[150px]">Nama Akun</th>
                    <th colspan="2" class="p-2 border bg-blue-900">Neraca Saldo</th>
                    <th colspan="2" class="p-2 border bg-green-900">Laba Rugi</th>
                    <th colspan="2" class="p-2 border bg-indigo-900">Neraca</th>
                </tr>
                <tr>
                    <th class="p-2 border bg-blue-800">D</th><th class="p-2 border bg-blue-800">K</th>
                    <th class="p-2 border bg-green-800">D</th><th class="p-2 border bg-green-800">K</th>
                    <th class="p-2 border bg-indigo-800">D</th><th class="p-2 border bg-indigo-800">K</th>
                </tr>
            </thead><tbody>`;
        
        let tNSD=0, tNSK=0, tLRD=0, tLRK=0, tNRD=0, tNRK=0;

        Object.keys(saldos).sort().forEach(akun => {
            const val = saldos[akun];
            const net = val.debit - val.kredit;
            const nsd = net > 0 ? net : 0; const nsk = net < 0 ? Math.abs(net) : 0;
            tNSD += nsd; tNSK += nsk;

            let lrd=0, lrk=0, nrd=0, nrk=0;
            if(akun.match(/biaya|beban|pendapatan|penjualan|gaji|listrik|air|internet/i)) { lrd = nsd; lrk = nsk; } 
            else { nrd = nsd; nrk = nsk; }
            tLRD+=lrd; tLRK+=lrk; tNRD+=nrd; tNRK+=nrk;

            html += `<tr class="hover:bg-slate-50 border-b"><td class="p-2 border-r sticky left-0 bg-white font-medium">${akun}</td>
            <td class="p-2 text-right border-r bg-blue-50">${nsd?fmt(nsd):'-'}</td><td class="p-2 text-right border-r bg-blue-50">${nsk?fmt(nsk):'-'}</td>
            <td class="p-2 text-right border-r bg-green-50">${lrd?fmt(lrd):'-'}</td><td class="p-2 text-right border-r bg-green-50">${lrk?fmt(lrk):'-'}</td>
            <td class="p-2 text-right border-r bg-indigo-50">${nrd?fmt(nrd):'-'}</td><td class="p-2 text-right bg-indigo-50">${nrk?fmt(nrk):'-'}</td></tr>`;
        });
        
        const laba = tLRK - tLRD;
        const slrd = laba>0?laba:0; const slrk = laba<0?Math.abs(laba):0;
        const snrk = laba>0?laba:0; const snrd = laba<0?Math.abs(laba):0;

        html += `<tr class="bg-slate-100 font-bold"><td class="p-2 sticky left-0 bg-slate-100">SUB TOTAL</td>
        <td class="p-2 text-right">${fmt(tNSD)}</td><td class="p-2 text-right">${fmt(tNSK)}</td>
        <td class="p-2 text-right">${fmt(tLRD)}</td><td class="p-2 text-right">${fmt(tLRK)}</td>
        <td class="p-2 text-right">${fmt(tNRD)}</td><td class="p-2 text-right">${fmt(tNRK)}</td></tr>`;

        html += `<tr class="bg-yellow-50 font-bold text-yellow-800"><td class="p-2 sticky left-0 bg-yellow-50">Laba (Rugi) Bersih</td>
        <td></td><td></td><td class="p-2 text-right border-b-2 border-double border-yellow-600">${fmt(slrd)}</td><td class="p-2 text-right border-b-2 border-double border-yellow-600">${fmt(slrk)}</td>
        <td class="p-2 text-right border-b-2 border-double border-yellow-600">${fmt(snrd)}</td><td class="p-2 text-right border-b-2 border-double border-yellow-600">${fmt(snrk)}</td></tr>`;
        
        html += `</tbody></table></div>`;
        document.getElementById("konten").innerHTML = html;
    }

    function renderLabaRugi() {
        const saldos = hitungSaldo();
        let pendapatan = 0, beban = 0;
        let html = `<div class="max-w-2xl mx-auto border p-4 bg-slate-50 rounded text-sm"><div class="font-bold text-slate-800 mb-2 border-b pb-1">PENDAPATAN</div><div class="flex justify-between font-bold text-green-700 mb-4"><span>TOTAL PENDAPATAN</span><span>${fmt(pendapatan)}</span></div><div class="font-bold text-slate-800 mb-2 border-b pb-1">BEBAN OPERASIONAL</div>`;
        for(let [akun, val] of Object.entries(saldos)) {
            if(akun.match(/biaya|beban|gaji|listrik|air|internet/i)) {
                const nilai = val.debit - val.kredit;
                if(nilai !== 0) { beban += nilai; html += `<div class="flex justify-between py-1 border-b border-dashed border-slate-200"><span>${akun}</span><span>${fmt(nilai)}</span></div>`; }
            }
        }
        html += `<div class="flex justify-between font-bold text-red-700 mt-2 mb-4"><span>TOTAL BEBAN</span><span>(${fmt(beban)})</span></div>`;
        const profit = pendapatan - beban; const color = profit >= 0 ? "bg-green-100 text-green-800" : "bg-red-100 text-red-800";
        html += `<div class="p-3 rounded font-bold text-center text-lg ${color} border border-current mt-4">LABA BERSIH: ${fmt(profit)}</div></div>`;
        document.getElementById("konten").innerHTML = html;
    }

    function renderNeraca() {
        const saldos = hitungSaldo();
        let aset = 0, kewajiban = 0, modal = 0; let htmlAset = "", htmlPasiva = "";
        for(let [akun, val] of Object.entries(saldos)) {
            const saldo = val.debit - val.kredit; if(saldo === 0) continue;
            if(akun.match(/kas|bank|piutang|persediaan|aset|tanah|bangunan/i)) { aset += saldo; htmlAset += `<div class="flex justify-between py-1 border-b border-dashed border-slate-200"><span>${akun}</span><span>${fmt(saldo)}</span></div>`; } 
            else if(akun.match(/hutang|kewajiban/i)) { const hut = Math.abs(saldo); kewajiban += hut; htmlPasiva += `<div class="flex justify-between py-1 border-b border-dashed border-slate-200"><span>${akun}</span><span>${fmt(hut)}</span></div>`; }
        }
        modal = aset - kewajiban;
        let html = `<div class="grid grid-cols-1 md:grid-cols-2 gap-6 text-sm"><div class="border p-4 rounded bg-white"><div class="font-bold text-blue-800 border-b-2 border-blue-500 mb-3 pb-1">ASET (AKTIVA)</div>${htmlAset}<div class="mt-4 pt-2 border-t-2 border-slate-800 font-bold flex justify-between text-base"><span>TOTAL ASET</span><span>${fmt(aset)}</span></div></div><div class="border p-4 rounded bg-white"><div class="font-bold text-red-800 border-b-2 border-red-500 mb-3 pb-1">KEWAJIBAN & MODAL</div>${htmlPasiva}<div class="flex justify-between py-1 border-b border-dashed border-slate-200 mt-4 font-bold text-slate-600"><span>Modal / Ekuitas</span><span>${fmt(modal)}</span></div><div class="mt-4 pt-2 border-t-2 border-slate-800 font-bold flex justify-between text-base"><span>TOTAL PASIVA</span><span>${fmt(kewajiban + modal)}</span></div></div></div>`;
        document.getElementById("konten").innerHTML = html;
    }

    function hitungSaldo() {
        const s = {};
        rawData.forEach(r => {
            if(!s[r.nama_akun]) s[r.nama_akun] = { debit:0, kredit:0 };
            s[r.nama_akun].debit += r.debit; s[r.nama_akun].kredit += r.kredit;
        });
        return s;
    }

    function downloadPDF() {
        const el = document.getElementById('laporanArea');
        document.querySelector('.print-only').style.display = 'block'; 
        const opt = {
            margin: 0.5,
            filename: `Laporan_${currentType}_NLD.pdf`,
            image: { type: 'jpeg', quality: 0.98 },
            html2canvas: { scale: 2, useCORS: true },
            jsPDF: { unit: 'cm', format: 'a4', orientation: 'landscape' }
        };
        html2pdf().set(opt).from(el).save().then(() => { document.querySelector('.print-only').style.display = 'none'; });
    }
  </script>
</body>
</html>E
